# Few Shot(少量)提示模板

Few-shot prompting是一种提示技术，它向大型语言模型（LLM）提供一系列示例，然后要求LLM在提供的示例的指导下生成一些文本。

一个例子如下：

假设您希望您的LLM以特定格式回应。您可以使用一系列的问答对来少样本提示LLM，使其知道以何种格式回应。

```txt
以下列格式回应用户的提问：

问题：你叫什么名字？
回答：我的名字是John。

问题：你多大了？
回答：我25岁了。

问题：你最喜欢的颜色是什么？
回答：
```

在这里，我们留下了最后一个`回答：`未定义，以便LLM可以填充它。然后，LLM将生成以下内容：

```txt
回答：我没有最喜欢的颜色；我没有偏好。
```

### 应用场景


在下面的示例中，我们使用FewShot技术来将LLM重述问题为更一般的查询。

我们提供了两组具体问题和重述的一般问题的示例。 `FewShotChatMessagePromptTemplate` 将使用我们的示例，当调用`.format`时，我们将看到这些示例被格式化为一个字符串，我们可以传递给LLM。


```typescript
import {
  ChatPromptTemplate,
  FewShotChatMessagePromptTemplate,
} from "langchain/prompts";
```

```typescript
const examples = [
  {
    input: "警察成员是否可以进行合法逮捕？",
    output: "警察成员能做什么？",
  },
  {
    input: "Jan Sindel出生在哪个国家？",
    output: "Jan Sindel的个人历史是什么？",
  },
];
const examplePrompt = ChatPromptTemplate.fromTemplate(`Human: {input}
AI: {output}`);
const fewShotPrompt = new FewShotChatMessagePromptTemplate({
  examplePrompt,
  examples,
  inputVariables: [], // 没有输入变量
});
```

```typescript
const formattedPrompt = await fewShotPrompt.format({});
console.log(formattedPrompt);
```

```typescript
[
  HumanMessage {
    lc_namespace: [ 'langchain', 'schema' ],
    content: 'Human: 警察成员可以进行合法逮捕吗？\n' +
      'AI: 警察成员可以做什么？',
    additional_kwargs: {}
  },
  HumanMessage {
    lc_namespace: [ 'langchain', 'schema' ],
    content: "Human: Jan Sindel出生在哪个国家？\n" +
      "AI: Jan Sindel的个人历史是什么？",
    additional_kwargs: {}
  }
]
```

然后，如果我们使用另一个问题，LLM将按照我们想要的方式重新表述问题。

import IntegrationInstallTooltip from "@mdx\_components/integration\_install\_tooltip.mdx";

<IntegrationInstallTooltip></IntegrationInstallTooltip>

```bash npm2yarn
npm install @langchain/openai
```

```typescript
import { ChatOpenAI } from "@langchain/openai";
```

```typescript
const model = new ChatOpenAI({});
const examples = [
  {
    input: "警察成员可以进行合法逮捕吗？",
    output: "警察成员可以做什么？",
  },
  {
    input: "Jan Sindel出生在哪个国家？",
    output: "Jan Sindel的个人历史是什么？",
  },
];
const examplePrompt = ChatPromptTemplate.fromTemplate(`Human: {input}
AI: {output}`);
const fewShotPrompt = new FewShotChatMessagePromptTemplate({
  prefix:
    "将用户的查询重新表述为更一般的查询，使用以下示例",
  suffix: "Human: {input}",
  examplePrompt,
  examples,
  inputVariables: ["input"],
});
const formattedPrompt = await fewShotPrompt.format({
  input: "法国的主要城市是什么？",
});

const response = await model.invoke(formattedPrompt);
console.log(response);
```

```typescript
AIMessage {
  lc_namespace: [ 'langchain', 'schema' ],
  content: '法国的首都是什么？',
  additional_kwargs: { function_call: undefined }
}
```

### 使用函数进行Few Shot处理


您还可以使用函数来部分化。这种情况的用例是当您知道您总是希望以常见的方式获取一个变量时。
其中一个典型例子是日期或时间。假设您有一个始终希望包含当前日期的提示。您不能在提示中硬编码它，
并且将其与其他输入变量一起传递可能很麻烦。在这种情况下，能够使用一个始终返回当前日期的函数来部分化提示非常方便。


```typescript
const getCurrentDate = () => {
  return new Date().toISOString();
};

const prompt = new FewShotChatMessagePromptTemplate({
  template: "告诉我一个关于{date}的{adjective}笑话",
  inputVariables: ["adjective", "date"],
});

const partialPrompt = await prompt.partial({
  date: getCurrentDate,
});

const formattedPrompt = await partialPrompt.format({
  adjective: "有趣的",
});

console.log(formattedPrompt)

// 告诉我一个有趣关于2023-07-13T00:54:59.287Z的笑话
```

### Few Shot vs Chat Few Shot

聊天和非聊天的Few Shot提示模板的工作方式类似。下面的示例将演示使用聊天和非聊天的方式，并说明它们输出的差异。

```typescript
import {
  FewShotPromptTemplate,
  FewShotChatMessagePromptTemplate,
} from "langchain/prompts";
```

```typescript
const examples = [
  {
    input: "警察成员能够进行合法逮捕吗？",
    output: "警察成员能做什么？",
  },
  {
    input: "Jan Sindel出生在哪个国家？",
    output: "Jan Sindel的个人历史是什么？",
  },
];
const prompt = `Human: {input}
AI: {output}`;
const examplePromptTemplate = PromptTemplate.fromTemplate(prompt);
const exampleChatPromptTemplate = ChatPromptTemplate.fromTemplate(prompt);
const chatFewShotPrompt = new FewShotChatMessagePromptTemplate({
  examplePrompt: exampleChatPromptTemplate,
  examples,
  inputVariables: [], // 没有输入变量
});
const fewShotPrompt = new FewShotPromptTemplate({
  examplePrompt: examplePromptTemplate,
  examples,
  inputVariables: [], // 没有输入变量
});
```

```typescript
console.log("Chat Few Shot: ", await chatFewShotPrompt.formatMessages({}));
/**
Chat Few Shot:  [
  HumanMessage {
    lc_namespace: [ 'langchain', 'schema' ],
    content: 'Human: 警察成员能够进行合法逮捕吗？\n' +
      'AI: 警察成员能做什么？',
    additional_kwargs: {}
  },
  HumanMessage {
    lc_namespace: [ 'langchain', 'schema' ],
    content: "Human: Jan Sindel出生在哪个国家？\n" +
      "AI: Jan Sindel的个人历史是什么？",
    additional_kwargs: {}
  }
]
 */
```

```typescript
console.log("Few Shot: ", await fewShotPrompt.formatPromptValue({}));
/**
Few Shot:

Human: 警察成员能够进行合法逮捕吗？
AI: 警察成员能做什么？

Human: Jan Sindel出生在哪个国家？
AI: Jan Sindel的个人历史是什么？
 */
```

在这里，我们可以看到 `FewShotChatMessagePromptTemplate` 和 `FewShotPromptTemplate` 之间的主要区别：输入和输出值。

`FewShotChatMessagePromptTemplate`通过接收一组`ChatPromptTemplate`作为示例，并将其输出为`BaseMessage`的实例列表。

另一方面，`FewShotPromptTemplate`通过接收一个`PromptTemplate`作为示例，并将其输出为字符串。

## 使用非聊天模型

LangChain还为非聊天模型提供了用于Few Shot提示格式化的类：`FewShotPromptTemplate`。API在很大程度上是相同的，但输出的格式不同（聊天消息 vs 字符串）。

### 带有函数的部分

```typescript
import {
  ChatPromptTemplate,
  FewShotChatMessagePromptTemplate,
} from "langchain/prompts";
```

```typescript
const examplePrompt = PromptTemplate.fromTemplate("{foo}{bar}");
const prompt = new FewShotPromptTemplate({
  prefix: "{foo}{bar}",
  examplePrompt,
  inputVariables: ["foo", "bar"],
});
const partialPrompt = await prompt.partial({
  foo: () => Promise.resolve("boo"),
});
const formatted = await partialPrompt.format({ bar: "baz" });
console.log(formatted);
```

```txt
boobaz\n
```

### 带有函数和示例选择器

```typescript
import {
  ChatPromptTemplate,
  FewShotChatMessagePromptTemplate,
} from "langchain/prompts";
```

```typescript
const examplePrompt = PromptTemplate.fromTemplate("关于{x}的一个例子");
const exampleSelector = await LengthBasedExampleSelector.fromExamples(
  [{ x: "foo" }, { x: "bar" }],
  { examplePrompt, maxLength: 200 }
);
const prompt = new FewShotPromptTemplate({
  prefix: "{foo}{bar}",
  exampleSelector,
  examplePrompt,
  inputVariables: ["foo", "bar"],
});
const partialPrompt = await prompt.partial({
  foo: () => Promise.resolve("boo"),
});
const formatted = await partialPrompt.format({ bar: "baz" });
console.log(formatted);
```

```txt
boobaz
关于foo的一个例子
关于bar的一个例子
```


